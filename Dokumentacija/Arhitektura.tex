\chapter{Arhitektura i dizajn sustava}
		Arhitektura naše aplikacije, može se podijeliti na sljedeće komponente
	\begin{itemize}
		\item 	Server strana (\textit{backend})
		\item 	Klijent strana (\textit{frontend})
		\item 	Baza podataka (\textit{db})		
	\end{itemize}
	\textbf{Serverska strana} glavna je komponenta naše aplikacije. U njoj se nalazi programska logika koja se brine da se korisniku isporuči ono što je zatražio i da aplikacija radi u skladu sa zahtjevima. Komunikacija prema klijentskoj strani ostvarena je korištenjem GraphQL-a (za manipulaciju s API-jem), a komunikacija prema bazi podataka ORM-om (Object-Relational Mapping). Također smo koristili razred Prisma kojem se predaju parametri SQL upita. Prisma je biblioteka sa serverske strane koja pomaže pri čitanju i pisanju podataka u i iz baze podataka na siguran način (štiti od SQL injekcija).
	
	\textbf{Baza podataka} koju smo koristili je PostgreSQL. Kako bi izbjegli programske greške u SQLu te potencijalne ranjivosti (npr. SQL injekcija), za komunikaciju s bazom koristili smo \textit{TypeORM} kako bi programer izbjegao greške u SQL jeziku. \textit{TypeOrm} je podvrsta radnog okvira ORM prilagođen TypeScriptu i JavaScriptu. Kroz \textit{TypeORM} dobili smo i sustav za verzioniranje baze podataka "migracije" tako da možemo lakše i sigurnije raditi izmjene na bazi te dijeliti te izmjene između programera u timu i produkcijskih servera. 
	
	\textbf{Klijentska strana} je pruža grafičko sučelje za olakšan i intuitivan pristup uslugama aplikacije. Ovu komponentu možemo zamisliti kao posrednika u komunikaciji između korisnika i serverske strane aplikacije. U našem slučaju klijentska strana implementirana je kao SPA (Single Page Application) s \textit{React}-om. \textit{React} je JavaScript knjižnica koja olakšava oblikovanje korisničkog sučelja.\\
	
	\begin{figure}[H]
		\includegraphics[width=\textwidth]{slike/arhitekturaDijagram.png} 
		\caption{Model arhitekture}
		\label{fig:arhitektura} 
	\end{figure}

				
		\section{Baza podataka}
		
		U našem sustavu korisimo PostgreSQL relacijsku bazu podataka za spremanje informacija o potresima i upitnicima. Zadaća baze podataka brza je i jednostavna pohrana, izmjena i dohvat podataka za daljnju obradu. Podaci će biti pohranjeni u tablice koje imaju svoje ime i atribute te će svaki entitet imati svoj primarni ključ, jedinstvenu
		oznakau svake n-torke koja ne smije imati vrijednost ”null”.
		U bazi podataka imamo sljedeće entitete:
		\begin{itemize}
			\item 	users
			\item 	earthquakes
			\item 	surveys
		\end{itemize}

			\subsection{Opis tablica}
			
				Tablica u kojoj se spremaju pristupni podaci te uloge korisnika u sustavu.
				\begin{longtblr}[
					label=none,
					entry=none
					]{
						width = \textwidth,
						colspec={|X[7,l]|X[7, l]|X[20, l]|}, 
						rowhead = 1,
					} %definicija širine tablice, širine stupaca, poravnanje i broja redaka naslova tablice
					\hline \multicolumn{3}{|c|}{\textbf{users}}	 \\ \hline[3pt]
					\SetCell{LightGreen}id & INT	&  	id korisnika  	\\ \hline
					created\_at	& TIMESTAMP &  vremenski žig kada je korisnik stvoren	\\ \hline 
					updated\_at	& TIMESTAMP &  vremenski žig kada je korisnik izmijenjen 	\\ \hline 
					email & VARCHAR &  email adresa korisnika \\ \hline 
					password\_hash & VARCHAR &  lozinka korisnika spremljena kao hash \\ \hline 
					role & Enum:UserRole &  uloga korisnika (admin i seizmolog) \\ \hline 
				\end{longtblr}

				Tablica u kojoj se spremaju prošli potresi, svaki potres može imati 0:n upitnika koje su građani ispunili.
				\begin{longtblr}[
					label=none,
					entry=none
					]{
						width = \textwidth,
						colspec={|X[7,l]|X[7, l]|X[20, l]|}, 
						rowhead = 1,
					} %definicija širine tablice, širine stupaca, poravnanje i broja redaka naslova tablice
					\hline \multicolumn{3}{|c|}{\textbf{earthquakes}}	 \\ \hline[3pt]
					\SetCell{LightGreen}id & INT	&  	id potresa  	\\ \hline
					created\_at	& TIMESTAMP &  vremenski žig kada je potres stvoren	\\ \hline 
					updated\_at	& TIMESTAMP &  vremenski žig kada je potres izmijenjen 	\\ \hline 
					name & VARCHAR &  naziv potresa \\ \hline 
					strength & REAL &  jačina potresa \\ \hline 
					epicenter\_lat & REAL &  geografska širina epicentra \\ \hline 
					epicenter\_lng & REAL &  geografska dužina epicentra \\ \hline 
					date	& TIMESTAMP &  vremenski žig kada se potres dogodio 	\\ \hline 
				\end{longtblr}

				Tablica u kojoj se nalaze ispunjeni upitnici.
				\begin{longtblr}[
					label=none,
					entry=none
					]{
						width = \textwidth,
						colspec={|X[7,l]|X[7, l]|X[20, l]|}, 
						rowhead = 1,
					} %definicija širine tablice, širine stupaca, poravnanje i broja redaka naslova tablice
					\hline \multicolumn{3}{|c|}{\textbf{surveys}}	 \\ \hline[3pt]
					\SetCell{LightGreen}id & INT	&  	id upitnika  	\\ \hline
					created\_at	& TIMESTAMP &  vremenski žig kada je upitnik stvoren	\\ \hline 
					updated\_at	& TIMESTAMP &  vremenski žig kada je upitnik izmijenjen 	\\ \hline 
					lat & REAL &  geografska širina upitnika \\ \hline 
					lng & REAL &  geografska dužina upitnika \\ \hline 
					\SetCell{LightBlue}earthquakeId	& INT &  id potresa za koji je ovaj upitnik ispunjen 	\\ \hline 
				\end{longtblr}

			
			\subsection{Dijagram baze podataka}

				\begin{figure}[H]
					\includegraphics[width=\textwidth]{slike/tectonicDBDiagram.png} 
					\caption{Dijagram baze podataka}
					\label{fig:baza} 
				\end{figure}

			\eject
			
			
		\section{Dijagram razreda}
			
			\begin{figure}[H]
				\includegraphics[width=\textwidth]{slike/classdiagram_only_db.png} 
				\caption{Dijagram razreda za modeliranje baze podataka}
				\label{fig:uml_db} 
			\end{figure}

			\begin{figure}[H]
				\includegraphics[width=\textwidth]{slike/classdiagram_no_db.png} 
				\caption{Dijagram razreda bez baze podataka}
				\label{fig:uml_no_db} 
			\end{figure}

			\begin{figure}[H]
				\includegraphics[width=\textwidth]{slike/classDiagram.png} 
				\caption{Dijagram razreda cijele aplikacije}
				\label{fig:uml} 
			\end{figure}

			\textbf{\textit{dio 2. revizije}}\\			
			
			\textit{Prilikom druge predaje projekta dijagram razreda i opisi moraju odgovarati stvarnom stanju implementacije}
			
			
			
			
			\eject
		
		\section{Dijagram stanja}
			
			
			\textbf{\textit{dio 2. revizije}}\\
			
			\textit{Potrebno je priložiti dijagram stanja i opisati ga. Dovoljan je jedan dijagram stanja koji prikazuje \textbf{značajan dio funkcionalnosti} sustava. Na primjer, stanja korisničkog sučelja i tijek korištenja neke ključne funkcionalnosti jesu značajan dio sustava, a registracija i prijava nisu. }
			
			
			\eject 
		
		\section{Dijagram aktivnosti}
		
		Dijagram aktivnosti služi za modeliranje procesa. On opisuje ponašanje različitih elemenata modela toka upravljanja ili toka podataka. Ne upotrebljava se za modeliranje ponašanja poticanog događajima. Prilikom modeliranja toka upravljanja svaki novi korak poduzima se nakon završenog
		prethodnog. Na slici 4.7 prikazan je dijagram aktivnosti procesa pregleda aktualnih potresa, njihovog pretraživanja i preuzimanja podataka za njih. 
		Na ovom dijagramu "Korisnik" može biti i seizmolog i administrator.
		
		Prvo se korisnik prijavljuje u sustav. Nakon uspješne prijave, na početnoj stranici odabire "Aktualni potresi". Korisnik vidi prikaz stranice aktualnih potresa. Korisnik može pretraživati potrese prema nekom parametru. Ako nema potresa koji zadovoljavaju korisnikov upit, sustav javlja korisniku da takvih potresa nema. Potresi s traženim svojstvima prikazat će se ako postoje potresi koji zadovoljavaju upit (npr. pretraga po nazivu, mjestu, jačini...). Ako korisnik ne želi filtrirati potrese, jednostavno neće upisati nikakav upit u tražilicu te će se i dalje prikazivati lista svih aktualnih potresa.
		
		Kada je pronašao željeni potres te ga označio, klikom na "Preuzmi" korisnik pokreće preuzimanje podataka za odabrani potres. Podatci se preuzimaju u .csv formatu. Korisnika se obavještava o uspješnom preuzimanju podataka.
		
		\begin{figure}[H]
			\includegraphics[width=\textwidth]{slike/dijagram_aktivnosti.png}
			\caption{Dijagram aktivnosti}
			\label{fig:uml_db} 
		\end{figure}
		
			
			\eject
		\section{Dijagram komponenti}
		
			\textbf{\textit{dio 2. revizije}}\\
		
			 \textit{Potrebno je priložiti dijagram komponenti s pripadajućim opisom. Dijagram komponenti treba prikazivati strukturu cijele aplikacije.}
		\eject